<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KAEL</title>
    <script src="//g.alicdn.com/dingding/dingtalk-jsapi/2.0.57/dingtalk.open.js"></script>
</head>
<body>
<script>

    function createXMLHttpRequest() {
        var xmlHttp;
        if (window.XMLHttpRequest) {
            xmlHttp = new XMLHttpRequest();
            if (xmlHttp.overrideMimeType)
                xmlHttp.overrideMimeType('text/xml');
        } else if (window.ActiveXObject) {
            try {
                xmlHttp = new ActiveXObject("Msxml2.XMLHTTP");
            } catch (e) {
                try {
                    xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
                } catch (e) {
                }
            }
        }
        return xmlHttp;
    }

    dd.ready(function() {
        document.write('ready1');
        dd.runtime.permission.requestAuthCode({
            corpId: '242747112', // 企业id
            onSuccess: function (info) {
                document.write('success');
                var code = info.code;
                document.write(code);

//                var url = 'http://' + window.location.host + '/meican/login/url-by-code?code='+code;
//                xmlHttp = createXMLHttpRequest();
//                xmlHttp.open("GET", url, true);// 异步处理返回
//                xmlHttp.onreadystatechange = function () {
//
//                };
//                xmlHttp.setRequestHeader("Content-Type",
//                    "application/x-www-form-urlencoded;");
//                xmlHttp.send();

//                alert(code);
//                var url = 'http://' + window.location.host + '/meican/login/ding?code='+code;
//                dd.biz.util.openLink({
//                    url:url,//要打开链接的地址
//                    onSuccess : function(result) {
//                        /**/
//                    },
//                    onFail : function(err) {}
//                });
//                window.location.href= 'http://' + window.location.host + '/meican/login/ding?code='+code;
            },
            onFail : function(err) {
                document.write(err.errorMessage);
            }});
    });
</script>
</body>
</html>